---
// src/components/albums/AlbumCarousel.astro
import type { SpotifyAlbum } from '../../types/spotify';
import SectionHeader from '../SectionHeader.astro';
import AlbumItem from './AlbumItem.astro';

interface Props {
  title: string;
  items: SpotifyAlbum[];
}

const { title, items } = Astro.props;
const id = `carousel-${title.toLowerCase().replace(/\s+/g, '-')}`;
---

<section class="flex flex-col gap-4 isolate [transform:translateZ(0)]">
  <div class="flex items-center justify-between px-2 [transform:translateZ(0)]">
    <div class="flex items-center gap-3">
      <SectionHeader title={title} />
      <span class="hidden sm:block text-[8px] text-zinc-500 font-black uppercase tracking-[0.2em] bg-white/5 px-2 py-0.5 rounded-full border border-white/5 antialiased">
        {items.length}
      </span>
    </div>

    <div class="flex items-center gap-1.5">
      <button 
        data-direction="left" 
        data-target={id}
        class="p-1.5 rounded-full bg-zinc-900/50 border border-white/5 text-zinc-500 hover:text-white hover:bg-zinc-800 transition-all active:scale-90 cursor-pointer outline-none will-change-transform"
        aria-label="Deslizar izquierda"
      >
        <svg class="w-4 h-4 antialiased" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg>
      </button>
      <button 
        data-direction="right" 
        data-target={id}
        class="p-1.5 rounded-full bg-zinc-900/50 border border-white/5 text-zinc-500 hover:text-white hover:bg-zinc-800 transition-all active:scale-90 cursor-pointer outline-none will-change-transform"
        aria-label="Deslizar derecha"
      >
        <svg class="w-4 h-4 antialiased" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg>
      </button>
    </div>
  </div>

  <div 
    id={id}
    class="flex overflow-x-auto gap-3 scroll-smooth snap-x px-2 pb-4 [scrollbar-width:none] [&::-webkit-scrollbar]:hidden overscroll-behavior-x-contain [transform:translateZ(0)]"
  >
    {items.map(item => (
      <div class="min-w-[140px] md:min-w-[170px] flex-shrink-0 snap-start [transform:translateZ(0)] [backface-visibility:hidden]">
        <AlbumItem album={item} />
      </div>
    ))}
  </div>
</section>

<script>
  function initCarousel() {
    // Usamos delegaciÃ³n de eventos para mayor eficiencia
    document.addEventListener('click', (e) => {
      const btn = (e.target as HTMLElement).closest('button[data-direction]');
      if (!btn) return;

      const direction = btn.getAttribute('data-direction');
      const targetId = btn.getAttribute('data-target');
      const container = document.getElementById(targetId!);
      
      if (container) {
        // Multiplicador basado en el ancho visible para un scroll natural
        const scrollAmount = container.offsetWidth * 0.8;
        container.scrollBy({
          left: direction === 'left' ? -scrollAmount : scrollAmount,
          behavior: 'smooth'
        });
      }
    });
  }

  // Ejecutar en carga inicial y tras transiciones de Astro
  initCarousel();
  document.addEventListener('astro:after-swap', initCarousel);
</script>