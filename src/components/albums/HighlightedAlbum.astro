---
import { getAlbum, getAlbumTracks } from "../../lib/spotify";
import TrackList from "../tracks/TrackList.astro";

interface Props {
  albumId: string;
}

const { albumId } = Astro.props;
const album = await getAlbum(albumId);
const allTracks = await getAlbumTracks(albumId);
const tracks = allTracks?.slice(0, 3) || [];

const albumUrl = `/album/${albumId}`;
---

<div class="group/container relative w-full rounded-3xl border border-white/10 bg-[#0a0a0b] overflow-hidden transition-colors duration-500 hover:border-white/20 isolate">
  
  <div class="absolute inset-0 -z-10 pointer-events-none overflow-hidden">
    <div class="absolute -left-[10%] -top-[30%] w-[60%] h-[80%] rounded-full blur-[100px] bg-[#1DB954]/10"></div>
    <div class="absolute -right-[5%] -bottom-[20%] w-[50%] h-[70%] rounded-full blur-[80px] bg-purple-900/10"></div>
    
    <div class="absolute inset-0 opacity-[0.03] bg-[url('https://grainy-gradients.vercel.app/noise.svg')]"></div>
  </div>

  <a href={albumUrl} class="absolute inset-0 z-10" aria-label={`Ir al álbum ${album?.name}`}></a>

  <div class="relative z-20 flex flex-col md:flex-row items-center gap-8 p-6 md:p-12 pointer-events-none">
    
    <div class="w-full md:w-[300px] lg:w-[320px] flex-shrink-0">
      <div class="relative aspect-square rounded-2xl overflow-hidden shadow-2xl shadow-black/50">
        <img 
          src={album?.images[0]?.url} 
          alt={album?.name}
          class="h-full w-full object-cover"
          loading="eager"
          decoding="async"
        />
        <div class="absolute inset-0 border border-white/10 rounded-2xl"></div>
      </div>
    </div>

    <div class="w-full flex flex-col min-w-0">
      <div class="mb-6 px-2">        
        <h3 class="text-3xl md:text-5xl font-black tracking-tighter text-white truncate italic leading-tight mb-2 antialiased">
          {album?.name}
        </h3>
        <p class="text-[10px] font-bold text-zinc-500 uppercase tracking-[0.4em] antialiased">
          {album?.artists.map(a => a.name).join(' • ')}
        </p>
      </div>

      <div class="relative z-30 pointer-events-auto bg-white/[0.03] rounded-xl border border-white/5 p-2 transition-colors duration-300 group-hover/container:bg-white/[0.06]">
        <TrackList 
          tracks={tracks} 
          albumImage={album?.images[0]?.url}
          showAlbumColumn={false}
          isTransparent={true} 
        />
      </div>
    </div>
  </div>
</div>

<style>
  /* Eliminamos todos los keyframes y will-change que forzaban capas innecesarias */
  div {
    backface-visibility: hidden;
    -webkit-font-smoothing: antialiased;
  }
</style>