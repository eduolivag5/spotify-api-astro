---
// src/components/tracks/TrackList.astro
interface Props {
  tracks: any[];
  artistName?: string;
  albumImage?: string;
  showAlbumColumn?: boolean;
  isTransparent?: boolean;
}

const { 
  tracks = [], 
  artistName, 
  albumImage, 
  showAlbumColumn = true, 
  isTransparent = false 
} = Astro.props;

const formatDuration = (ms: number) => {
  const min = Math.floor(ms / 60000);
  const sec = Math.floor((ms % 60000) / 1000);
  return `${min}:${sec.toString().padStart(2, '0')}`;
};

const formatPlayedAt = (dateStr: string) => {
  const date = new Date(dateStr);
  return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
};
---

<div class:list={[
  "block overflow-hidden isolate", 
  !isTransparent && "rounded-3xl border border-white/5 bg-black/20 backdrop-blur-3xl shadow-2xl"
]}>
  <div class="flex flex-col" id="track-container">
    {tracks.map((track, index) => {
      const artists = track.artists?.map((a: any) => a.name).join(', ') || artistName;
      const displayImage = track.album?.images?.[0]?.url || albumImage;

      return (
        <button 
          class="track-row group grid grid-cols-[40px_1fr_80px] md:grid-cols-[40px_2fr_1.5fr_100px] items-center gap-4 px-6 py-3 text-left border-b border-white/[0.02] last:border-0 w-full cursor-pointer hover:bg-white/[0.04] transition-all duration-200"
          data-track={JSON.stringify({ name: track.name, artist: artists, image: displayImage })}
        >
          <div class="relative flex items-center justify-center">
            <span class="text-[11px] font-bold text-zinc-600 group-hover:opacity-0 transition-opacity font-mono">
              {(index + 1).toString().padStart(2, '0')}
            </span>
            <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
               <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="text-[#1DB954]">
                <path d="M8 5v14l11-7z"/>
              </svg>
            </div>
          </div>

          <div class="flex items-center gap-4 min-w-0">
            {displayImage && (
              <img src={displayImage} class="w-10 h-10 rounded shadow-lg object-cover flex-shrink-0" alt="" loading="lazy" />
            )}
            <div class="flex flex-col min-w-0">
              <span class="truncate text-[13px] font-black text-white/90 group-hover:text-white">
                {track.name}
              </span>
              <span class="truncate text-[10px] font-bold text-zinc-500 uppercase tracking-tight">
                {artists}
              </span>
            </div>
          </div>

          {showAlbumColumn && (
            <div class="hidden md:flex flex-col min-w-0">
              <span class="truncate text-[11px] font-bold text-zinc-600">
                {track.album?.name || ""}
              </span>
              {track.played_at && (
                 <span class="text-[9px] text-zinc-500/50 uppercase font-black">
                   {new Date(track.played_at).toLocaleDateString([], { day: '2-digit', month: 'short' })}
                 </span>
              )}
            </div>
          )}

          <div class="flex flex-col items-end justify-center">
            {track.played_at ? (
              <span class="text-[11px] font-black text-white/40 group-hover:text-[#1DB954] transition-colors">
                {formatPlayedAt(track.played_at)}
              </span>
            ) : (
              <span class="text-[10px] text-zinc-600 font-mono font-bold">
                {formatDuration(track.duration_ms)}
              </span>
            )}
          </div>
        </button>
      );
    })}
  </div>
</div>