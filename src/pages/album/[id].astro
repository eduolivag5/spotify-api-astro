---
// src/pages/albums/[id].astro
import GlassHeader from '../../components/GlassHeader.astro';
import TrackList from '../../components/tracks/TrackList.astro';
import Layout from '../../layouts/Layout.astro';
import { getAlbum, getAlbumTracks } from '../../lib/spotify';

const { id } = Astro.params;
const album = await getAlbum(id!);
const tracks = await getAlbumTracks(id!);
if (!album) return Astro.redirect('/404');

const releaseYear = album.release_date.split('-')[0];
---

<Layout title={`${album.name} - ${album.artists[0].name}`}>
  
  <GlassHeader 
    id={album.id}
    title={album.name}
    image={album.images[0]?.url}
    type={album.album_type === 'single' ? 'Sencillo' : 'Álbum'}
    transitionName="album"
  >
    <div slot="details" class="flex items-center gap-3 text-sm font-medium text-white/60">
      <a href={`/artists/${album.artists[0].id}`} class="text-white hover:text-[#1DB954] transition-colors font-bold">
        {album.artists[0].name}
      </a>
      <span class="text-white/10">•</span>
      <span>{releaseYear}</span>
      <span class="text-white/10">•</span>
      <span class="font-mono text-xs">{album.total_tracks} pistas</span>
    </div>
  </GlassHeader>

  <TrackList 
    tracks={tracks} 
    artistName={album.artists[0].name} 
    albumImage={album.images[0]?.url} 
  />

</Layout>