---
import { getRecentlyPlayed } from '../lib/spotify';
import Layout from '../layouts/Layout.astro';

const trackItems = await getRecentlyPlayed(50);
---
  <main class="flex flex-col gap-10 px-8 py-12 max-w-7xl mx-auto">
    
    <header class="flex flex-col gap-2">
      <span class="text-[11px] font-black uppercase tracking-[0.6em] text-zinc-500">
        Archivo de Escucha
      </span>
      <h1 class="text-6xl font-black tracking-tighter text-white italic">
        History<span class="text-[#1DB954]/50">.</span>
      </h1>
      <p class="text-zinc-500 text-sm font-medium tracking-tight mt-2 italic">
        Un registro detallado de tus últimas 50 reproducciones.
      </p>
    </header>

    <div class="relative block rounded-[2.5rem] border border-white/10 bg-black/20 backdrop-blur-3xl overflow-hidden shadow-2xl">
      <div class="grid grid-cols-[48px_2fr_1fr_100px] gap-4 px-8 py-5 border-b border-white/5 text-[10px] font-black uppercase tracking-[0.2em] text-zinc-400 bg-white/[0.02]">
        <div class="flex justify-center font-mono">ID</div>
        <div>Track</div>
        <div class="hidden md:block">Álbum</div>
        <div class="text-right">Registro</div>
      </div>

      <div class="flex flex-col">
        {trackItems.map((item, index) => {
          const { track } = item;
          const artistNames = track.artists.map(a => a.name).join(', ');
          const playedAt = new Date(item.played_at);
          
          return (
            <div class="group grid grid-cols-[48px_2fr_1fr_100px] items-center gap-4 px-8 py-4 border-b border-white/[0.03] last:border-0 transition-colors hover:bg-white/[0.02]">
              
              <div class="flex items-center justify-center">
                <span class="text-[10px] font-mono font-bold text-zinc-700">
                  {(index + 1).toString().padStart(2, '0')}
                </span>
              </div>

              <div class="flex items-center gap-5 min-w-0">
                <img src={track.album.images[0]?.url} class="h-10 w-10 rounded-md object-cover grayscale-[50%] group-hover:grayscale-0 transition-all shadow-lg" alt="" />
                <div class="flex flex-col min-w-0">
                  <span class="truncate text-sm font-black text-white/90">{track.name}</span>
                  <span class="truncate text-[10px] font-bold text-zinc-500 uppercase tracking-widest">
                    {artistNames}
                  </span>
                </div>
              </div>

              <div class="hidden md:block truncate text-xs font-bold text-zinc-600">
                {track.album.name}
              </div>

              <div class="flex flex-col text-right">
                <span class="text-[10px] font-black text-white/40">
                  {playedAt.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                </span>
                <span class="text-[9px] font-black text-zinc-700 uppercase tracking-tighter">
                   {playedAt.toLocaleDateString([], { day: '2-digit', month: 'short' })}
                </span>
              </div>
            </div>
          );
        })}
      </div>
    </div>
  </main>